# PokerMind Arena - 最终技术架构 (v2.0)

> **版本**: 最终版 | **更新日期**: 2026-02-15 | **状态**: 待开发

## 🎯 项目定位

**PokerMind Arena** = LLM人格对抗 + 链上可验证 + 预测市场

> "不是AI打扑克，是AI在扑克桌上吵架，而每一句话都被记录在链上"

### 赛道匹配（赛道3：智能体驱动的应用）

| 赛道要求 | 我们的方案 | 匹配度 |
|----------|-----------|--------|
| 智能体对抗、竞争与协作 | 4个AI扑克对战 | ✅ |
| 与预测市场/竞猜结合 | 彩池制投注 | ✅ |
| 短周期高频(5-10分钟) | All-in or Fold (30秒/局) | ✅ |
| 决策逻辑可验证 | **decisionHash上链 + IPFS** | ✅ 补强 |
| 低门槛免Gas参与 | Arcade Token | ✅ |

---

## ⚡ 核心设计原则

### 做减法（节省时间）

| 砍掉 | 改用 | 节省 |
|------|------|------|
| 自研德扑引擎 | `pokersolver` 库 | 15h |
| 标准无限德扑 | All-in or Fold | 10h |
| Merkle Tree | 简单 decisionHash | 8h |
| 动态赔率算法 | 彩池制(Parimutuel) | 8h |
| PostgreSQL/Redis | 内存状态 | 5h |

### 做加法（提升获奖率）

| 增强 | 目的 | 投入 |
|------|------|------|
| AI垃圾话流式输出 | 消除冷场 | 4h |
| AI互相@机制 | 制造戏剧冲突 | 2h |
| **链上验证演示面板** | **补强可验证性** | 3h |
| **模拟观众测试模式** | **弥补无真实用户** | 2h |
| 胜率实时显示 | ESPN专业感 | 2h |

---

## 系统架构图（最终版）

```
┌─────────────────────────────────────────────────────────────────────┐
│                     Frontend (React + Framer Motion)                 │
│                                                                      │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │
│  │ ESPN牌桌视角  │  │  AI对话气泡   │  │  彩池投注     │            │
│  │ (上帝模式)    │  │  (流式输出)   │  │  (一键投注)   │            │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘            │
│          │                  │                  │                     │
│  ┌───────┴──────────────────┴──────────────────┴───────┐            │
│  │                🔗 Verification Panel [新增]          │            │
│  │  [查看IPFS原始数据] [本地验证Hash] [区块浏览器链接]   │            │
│  └──────────────────────────┬──────────────────────────┘            │
│                             │                                        │
│                    ┌────────┴────────┐                               │
│                    │  Zustand Store  │                               │
│                    └────────┬────────┘                               │
└─────────────────────────────┼────────────────────────────────────────┘
                              │ WebSocket (实时) + REST (验证)
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       Backend (Node.js + Fastify)                    │
│                                                                      │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐     │
│  │   Game     │  │    AI      │  │  Predict   │  │  Verify    │     │
│  │  Engine    │  │  Dialogue  │  │  Market    │  │  Service   │     │
│  │(pokersolver)│  │(流式LLM)  │  │ (彩池制)   │  │(Hash+IPFS) │     │
│  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘     │
│        │               │               │               │            │
│        └───────────────┼───────────────┼───────────────┘            │
│                        │               │                             │
│                        ▼               ▼                             │
│              ┌──────────────────────────────────┐                   │
│              │     Decision Logger [核心]       │                   │
│              │  - 记录每个AI的决策+对话         │                   │
│              │  - 计算 keccak256(decisions)     │                   │
│              │  - 上传IPFS → 写入合约           │                   │
│              └──────────────────────────────────┘                   │
└─────────────────────────────┬───────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌──────────────┐     ┌──────────────┐     ┌────────────────────────┐
│  In-Memory   │     │    IPFS      │     │    Monad Testnet       │
│  (游戏状态)   │     │ (完整日志)   │     │   GameVerifier.sol     │
│              │     │              │     │ - commitGame()         │
│              │     │              │     │ - verifyHash() [新增]  │
└──────────────┘     └──────────────┘     └────────────────────────┘
```

---

## 模块清单（最终版）

| # | 模块 | 文档 | 核心变更 |
|---|------|------|----------|
| 1 | 游戏引擎 | [01-game-engine.md](./01-game-engine.md) | pokersolver + All-in or Fold |
| 2 | AI对话系统 | [02-ai-agents.md](./02-ai-agents.md) | 流式输出 + @互喷 + 情绪系统 |
| 3 | **链上验证** | [03-blockchain-verification.md](./03-blockchain-verification.md) | **decisionHash + verifyHash() + 前端演示** |
| 4 | 预测市场 | [04-prediction-market.md](./04-prediction-market.md) | 彩池制 + **模拟观众** |
| 5 | 前端界面 | [05-frontend-visualization.md](./05-frontend-visualization.md) | ESPN风格 + **验证面板** |

---

## 开发时间（最终版）

| 模块 | 时间 | 优先级 | 说明 |
|------|------|--------|------|
| 游戏引擎 | 8h | P0 | pokersolver集成 |
| AI对话系统 | 14h | P0 | 流式+@+情绪 |
| **链上验证** | **6h** | **P0** | **补强后必做** |
| 预测市场 | 6h | P1 | 彩池+模拟 |
| 前端界面 | 18h | P0 | ESPN+验证面板 |
| 集成测试 | 8h | P1 | - |
| **总计** | **60h** | - | 节省61h |

---

## 技术栈（精简版）

### 后端
```json
{
  "dependencies": {
    "fastify": "^4.x",
    "socket.io": "^4.x",
    "pokersolver": "^2.x",
    "ethers": "^6.x",
    "web3.storage": "^4.x"
  }
}
```

### 前端
```json
{
  "dependencies": {
    "react": "^18.x",
    "zustand": "^4.x",
    "framer-motion": "^10.x",
    "socket.io-client": "^4.x",
    "tailwindcss": "^3.x",
    "ethers": "^6.x"
  }
}
```

### 智能合约
- Solidity 0.8.20 + Hardhat
- 目标链: Monad Testnet

---

## 项目目录结构（最终版）

```
pokermind-arena/
├── apps/
│   ├── web/                      # 前端
│   │   ├── src/
│   │   │   ├── components/
│   │   │   │   ├── PokerTable/   # 牌桌
│   │   │   │   ├── AIDialogue/   # AI对话
│   │   │   │   ├── Prediction/   # 预测
│   │   │   │   └── Verify/       # 验证面板 [新增]
│   │   │   ├── stores/
│   │   │   └── hooks/
│   │   └── package.json
│   │
│   └── server/                   # 后端
│       ├── src/
│       │   ├── game/             # 游戏逻辑
│       │   ├── ai/               # AI对话
│       │   ├── market/           # 预测市场
│       │   ├── verify/           # 验证服务 [补强]
│       │   └── ws/               # WebSocket
│       └── package.json
│
├── contracts/                    # 智能合约
│   ├── GameVerifier.sol          # 含 verifyHash()
│   └── scripts/deploy.ts
│
├── docs/                         # 技术文档
└── README.md
```

---

## 里程碑计划

### Week 1 (2/15-2/21): 核心功能
| 日期 | 任务 | 产出 |
|------|------|------|
| Day 1-2 | 游戏引擎 + AI框架 | 可运行一局 |
| Day 3-4 | AI对话调优 + @机制 | AI能互喷 |
| Day 5-6 | 前端牌桌基础 | 能看到牌桌 |
| Day 7 | 联调测试 | 前后端通 |

### Week 2 (2/22-2/28): 完善+演示
| 日期 | 任务 | 产出 |
|------|------|------|
| Day 8-9 | 预测市场 + **链上验证** | 可投注+可验证 |
| Day 10-11 | 前端动画 + **验证面板** | 演示级UI |
| Day 12 | **模拟测试** + Bug修复 | 稳定运行 |
| Day 13 | 录制Demo视频 | 5分钟视频 |
| Day 14 | 提交 + 文档整理 | 完成提交 |

---

## 演示脚本（5分钟）

| 时间 | 内容 | 重点展示 |
|------|------|----------|
| 0:00-0:30 | **Hook** | AI在牌桌上互喷垃圾话 |
| 0:30-1:30 | 完整一局 | All-in决策 + 流式对话 |
| 1:30-2:30 | 预测市场 | 观众投注 + 结算动画 |
| 2:30-3:30 | **链上验证** | IPFS下载 → Hash比对 → 链上确认 |
| 3:30-4:30 | 商业愿景 | 平台抽水、AI角色NFT |
| 4:30-5:00 | 总结 | 团队介绍、未来计划 |

---

## 风险与应对

| 风险 | 概率 | 应对 |
|------|------|------|
| LLM响应慢 | 高 | 并行预加载 + 流式输出 |
| 链上交互失败 | 中 | 本地mock + 录制备用视频 |
| 时间不够 | 中 | 砍P2功能，保核心Demo |
| 演示出Bug | 中 | 提前录制完整流程视频 |

---

## 获奖关键点

### 必须做好的3件事

1. **AI互喷要有趣** - 评委记住的是"AI在吵架"
2. **验证要能演示** - 现场点击就能看到Hash比对结果
3. **流程要流畅** - 无冷场，5分钟内讲完故事

### Pitch一句话

> "PokerMind Arena让LLM成为德州扑克玩家——它们会诈唬、会互喷、会上头，而每一个决策都可在链上验证。观众可以像看比赛一样观战，并通过预测市场押注谁会赢。"
